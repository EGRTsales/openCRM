twentyreasonstheme={timedFunction:null,moreModulesCollapsed:true,groupsCollapsed:true,footerLineCollapsed:true,collapsed:new Array,collapsedStatic:new Array,selectedGroup:"",menuStore:{},menuItemsStore:{},openItemMenu:null,openingItemMenu:null,currentMenuItem:null,errorcount:0,errorsdisplayed:false,cpdisplayed:false,currentEditedPage:null,toggleActivePage:function(activePage){window.location="index.php?module=Home&action=index&activePage="+activePage},addPage:function(){$("#pageEdit").insertBefore("#pageItem0");
document.getElementById("pageTitle").value="new Page";document.getElementById("pageColumns").value=2;document.getElementById("moduleTab_HomeMenu").style.display="none";document.getElementById("pageEdit").style.display="block";twentyreasonstheme.currentEditedPage="new"},editPage:function(pageIndex){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=getPage&to_pdf=true&pageIndex="+pageIndex,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);
else{var pageItemObj=jQuery.parseJSON(result);$("#pageEdit").insertAfter("#pageItem"+pageItemObj.index);document.getElementById("pageTitle").value=pageItemObj.pageTitle;document.getElementById("pageColumns").value=pageItemObj.numColumns;if(pageItemObj.index==0)document.getElementById("pageEditDeleteButton").style.display="none";else document.getElementById("pageEditDeleteButton").style.display="inline";document.getElementById("pageEdit").style.display="block";twentyreasonstheme.currentEditedPage=
pageItemObj.index}}})},cancelPageEdit:function(){document.getElementById("pageEdit").style.display="none";twentyreasonstheme.currentEditedPage=null},commitPageEdit:function(){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=setPage&to_pdf=true&pageIndex="+twentyreasonstheme.currentEditedPage+"&pageTitle="+document.getElementById("pageTitle").value+"&pageColumns="+document.getElementById("pageColumns").value,success:function(result){if(result.search('value="Login"')>
-1)twentyreasonstheme.displayLogin(result);else window.location="index.php?module=Home&action=index&activePage="+result}})},deletePage:function(){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=deletePage&to_pdf=true&pageIndex="+twentyreasonstheme.currentEditedPage+"&pageTitle="+document.getElementById("pageTitle").value+"&pageColumns="+document.getElementById("pageColumns").value,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);
else window.location="index.php?module=Home&action=index"}})},resetPages:function(){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=resetPages&to_pdf=true",success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else window.location="index.php?module=Home&action=index"}})},toggleFavorite:function(){if(document.getElementById("beanisfavorite").value=="0"){document.getElementById("beanisfavorite").value="1";document.getElementById("iafavoriteinactive").style.display=
"none";document.getElementById("iafavoriteactive").style.display="block"}else{document.getElementById("beanisfavorite").value="0";document.getElementById("iafavoriteinactive").style.display="block";document.getElementById("iafavoriteactive").style.display="none"}var form=document.getElementById("formDetailView");$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=toggleFavorite&to_pdf=true&favorite="+document.getElementById("beanisfavorite").value+"&beanid="+form.record.value+
"&bean="+form.module.value,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result)}})},toggleMoreModules:function(){if(this.moreModulesCollapsed){document.getElementById("moreModuleItems").style.visibility="visible";this.moreModulesCollapsed=false;$("#MoreModules").mouseleave(function(){document.getElementById("moreModuleItems").style.visibility="hidden";twentyreasonstheme.moreModulesCollapsed=true})}else{document.getElementById("moreModuleItems").style.visibility=
"hidden";this.moreModulesCollapsed=true}},changeGroup:function(selectedGroup){if(!this.menuStore[document.getElementById("currentGroup").innerHTML])this.menuStore[document.getElementById("currentGroup").innerHTML]=document.getElementById("newSubmenu").innerHTML;document.getElementById("currentGroup").innerHTML=selectedGroup;document.getElementById("newSubmenu").style.display="none";document.getElementById("newSubmenuloading").style.display="inline";if(this.menuStore[selectedGroup]){document.getElementById("newSubmenu").style.display=
"inline";document.getElementById("newSubmenuloading").style.display="none";document.getElementById("newSubmenu").innerHTML=this.menuStore[selectedGroup];$(".newsubmenuitem").mouseenter(function(e){twentyreasonstheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_",""));twentyreasonstheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")});$(".newsubmenuitem").mouseleave(function(){$("#"+twentyreasonstheme.openItemMenu).remove();twentyreasonstheme.openItemMenu=
null;twentyreasonstheme.openingItemMenu=null})}else $.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=changeGroup&to_pdf=true&newGroup="+selectedGroup+"&currentModule="+document.getElementById("currentModule").innerHTML,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{document.getElementById("newSubmenu").style.display="inline";document.getElementById("newSubmenuloading").style.display="none";document.getElementById("newSubmenu").innerHTML=
result;$(".newsubmenuitem").mouseenter(function(e){twentyreasonstheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_",""));twentyreasonstheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")});$(".newsubmenuitem").mouseleave(function(){$("#"+twentyreasonstheme.openItemMenu).remove();twentyreasonstheme.openItemMenu=null;twentyreasonstheme.openingItemMenu=null})}}})},toggleGroups:function(){if(this.groupsCollapsed){document.getElementById("tabGroupDropDown").style.visibility=
"visible";this.groupsCollapsed=false;$("#groupdropdowntab").mouseleave(function(){document.getElementById("tabGroupDropDown").style.visibility="hidden";twentyreasonstheme.groupsCollapsed=true})}else{document.getElementById("tabGroupDropDown").style.visibility="hidden";this.groupsCollapsed=true}},removeItemMenu:function(item){if(this.openItemMenu&&1==2){$("#"+this.openItemMenu).remove();this.openItemMenu=null}},triggerRemoveItemMenu:function(item){if(this.openItemMenu&&this.openItemMenu=="moduleTab_"+
item+"Menu")this.timedFunction=window.setTimeout("twentyreasonstheme.removeItemMenu('"+item+"')",300)},cancelRemoveItemMenu:function(){if(this.timedFunction){window.clearTimeout(this.timedFunction);this.timedFunction=null}},displayItemMenu:function(item){if(this.currentMenuItem==item&&$(".moduletabitemmenu").length==0&&twentyreasonstheme.openingItemMenu==item){var thisOffset=$("#"+item+"tab").offset();var newDiv=document.createElement("div");newDiv.id="moduleTab_"+item+"Menu";newDiv.className="moduletabitemmenu";
newDiv.style.left=thisOffset.left+"px";var resultObj=jQuery.parseJSON(twentyreasonstheme.menuItemsStore[item]);newDiv.innerHTML=resultObj.menu+resultObj.lastviewed+resultObj.favorites;document.getElementById(item+"tab").appendChild(newDiv);this.openItemMenu=newDiv.id;$(".newsubmenuitem").mouseleave(function(){$("#"+twentyreasonstheme.openItemMenu).remove();twentyreasonstheme.openItemMenu=null})}},getItemMenu:function(item){if(!this.menuItemsStore[item])$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=getMenu&to_pdf=true&activeModule="+
currentModule+"&currentModule="+item,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{twentyreasonstheme.menuItemsStore[item]=result;twentyreasonstheme.displayItemMenu(item)}}});else twentyreasonstheme.displayItemMenu(item)},triggerItemMenu:function(item){this.timedFunction=window.setTimeout("twentyreasonstheme.getItemMenu('"+item+"')",400);this.currentMenuItem=item},cancelLoadItemMenu:function(item){if(this.timedFunction){window.clearTimeout(this.timedFunction);
this.timedFunction=null;this.currentMenuItem=null}this.triggerRemoveItemMenu(item)},getErrorCount:function(){errorCountArray=document.getElementById("errormessages").innerHTML.match(/\<p class/g);if(errorCountArray){this.errorcount=errorCountArray.length;document.getElementById("errorcount").innerHTML=errorCountArray.length;document.getElementById("errorcountli").style.display="inline"}if(document.getElementById("statistics")!=null)document.getElementById("statistics").innerHTML=document.getElementById("responseTime").innerHTML},
closeCopyright:function(){document.getElementById("copyright").style.display="none";this.cpdisplayed=false},displayCopyright:function(){if(this.cpdisplayed){document.getElementById("copyright").style.display="none";this.cpdisplayed=false}else{cprightpos=$(document.getElementById("poweredbysugarcrm")).offset();cprightpos.top=cprightpos.top-210;cprightpos.left=cprightpos.left;$(document.getElementById("copyright")).css(cprightpos);document.getElementById("copyright").style.display="inline";this.cpdisplayed=
true}},displayErrors:function(){if(this.errorsdisplayed){document.getElementById("errormessages").style.display="none";this.errorsdisplayed=false}else{errorcountpos=$(document.getElementById("errorcount")).offset();errorcountpos.top=errorcountpos.top-(this.errorcount*30+30);errorcountpos.left=errorcountpos.left;$(document.getElementById("errormessages")).css(errorcountpos);$(document.getElementById("errormessages")).css("height","auto");document.getElementById("errormessages").style.display="inline";
this.errorsdisplayed=true}},hideActionButtons:function(){document.getElementById("actionmenu").appendChild(document.getElementById("SAVE_HEADER"))},hijackActionMenu:function(){$(".SugarActionMenu").each(function(){var elements=$(this).children("li").children("ul").children("li");$(this).append(elements)})},hijackModuleTitle:function(){if(typeof action_sugar_grp1!="undefined"){if(action_sugar_grp1!="DetailView")$("#itemactions").css("display","none")}else $("#itemactions").css("display","none");elements=
$(".moduleTitle");if(elements.length>0){$("#moduleTitleDummy").addClass("moduleTitle");$("#moduleTitleDummy").show();$("#moduleTitleDummy").html($(elements[0]).html())}},registerEvents:function(){$(document).click(function(e){if(e.target.id!="copyright"&&e.target.id!="poweredbysugarcrm"&&twentyreasonstheme.cpdisplayed){document.getElementById("copyright").style.display="none";twentyreasonstheme.cpdisplayed=false}if(e.target.id!="errormessages"&&e.target.parentNode.id!="errormessages"&&e.target.id!=
"errorcount"&&twentyreasonstheme.errorsdisplayed){document.getElementById("errormessages").style.display="none";twentyreasonstheme.errorsdisplayed=false}});$(".newsubmenuitem").mouseenter(function(e){twentyreasonstheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_",""));twentyreasonstheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")});$(".newsubmenuitem").mouseleave(function(){$("#"+twentyreasonstheme.openItemMenu).remove();twentyreasonstheme.openItemMenu=
null;twentyreasonstheme.openingItemMenu=null});if(document.getElementById("iareminder")!=null){$("#iareminder").click(function(){$("#iareminderpicker").show()});$("#iaremindernew").click(function(){$("#iareminderpicker").show()});$("#iareminderremove").click(function(){twentyreasonstheme.removeReminder()})}$("#TRSideBar").sortable({items:"div.shortcuts",distance:15,axis:"y",opacity:0.8,cursorAt:{left:5},revert:true,update:function(event,ui){twentyreasonstheme.sortSave()}});$("#TRSideBar div.shortcuts span.shortcutstitle").css("cursor",
"move");$("#TRSideBar").disableSelection();if(typeof action_sugar_grp1!="undefined")if(action_sugar_grp1=="DetailView"&&subpanelsTabbed&&$("#groupTabs").length==0)twentyreasonstheme.subpanelsTabbed()},setDatepicker:function(){if(typeof action_sugar_grp1!="undefined")if(document.getElementById("iareminderpicker")!=null&&action_sugar_grp1=="DetailView"){$("#iareminderpicker").datepicker({dateFormat:cal_date_format.replace(/\%/g,"").replace("Y","yy"),defaultDate:$("#iareminder").html(),numberOfMonths:2,
onSelect:function(dateText,inst){document.getElementById("iareminder").innerHTML=dateText;var detailViewForm=document.getElementById("formDetailView");$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=setReminder&to_pdf=true&reminderDate="+dateText+"&beanId="+detailViewForm.record.value+"&beanmodule="+detailViewForm.module.value,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{$("#widget_cotent_Reminders").html(result);
$("#combo_Reminders").html(result)}}});$("#iareminderpicker").hide();$("#iareminderremove").css("display","inline");$("#iaremindernew").css("display","none")}}).hide();if($("#iareminder").html()!="")$("#iareminderremove").css("display","inline");else $("#iaremindernew").css("display","inline")}},removeReminderById:function(beanid){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=removeReminder&to_pdf=true&beanId="+beanid,success:function(result){if(result.search('value="Login"')>
-1)twentyreasonstheme.displayLogin(result);else{$("#widget_cotent_Reminders").html(result);$("#combo_Reminders").html(result)}}});detailViewForm=document.getElementById("formDetailView");if(detailViewForm!=undefined&&detailViewForm.record.value==beanid){$("#iareminderremove").css("display","none");$("#iaremindernew").css("display","inline");document.getElementById("iareminder").innerHTML=""}},removeReminder:function(){$("#iareminderpicker").hide();detailViewForm=document.getElementById("formDetailView");
$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=removeReminder&to_pdf=true&beanId="+detailViewForm.record.value,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{$("#widget_cotent_Reminders").html(result);$("#combo_Reminders").html(result)}}});$("#iareminderremove").css("display","none");$("#iaremindernew").css("display","inline");document.getElementById("iareminder").innerHTML="";$("#iareminderpicker").datepicker.defaultDate=
""},toggleFooterline:function(save,animated){if(this.footerLineCollapsedStatic||!save){if(animated==false){$("#footerline").css("width","100%");$("#expand_footerline span").removeClass("arrow_right");$("#expand_footerline span").addClass("arrow_left");$("#welcome_slide").removeAttr("style");twentyreasonstheme.getErrorCount()}else{$("#footerline").animate({width:"100%"},1E3);setTimeout(function(){$("#expand_footerline span").removeClass("arrow_right");$("#expand_footerline span").addClass("arrow_left");
$("#welcome_slide").fadeIn();twentyreasonstheme.getErrorCount()},600)}this.footerLineCollapsed=false;if(save){this.footerLineCollapsedStatic=false;this.setToggleFooterline(false)}}else{$("#expand_footerline span").removeClass("arrow_left");$("#expand_footerline span").addClass("arrow_right");$("#welcome_slide").fadeOut();$("#footerline").animate({width:"165px"},1E3);this.footerLineCollapsed=true;if(save){this.footerLineCollapsedStatic=true;this.setToggleFooterline(true)}}},toggleFooterline_mouseover:function(event){if(this.footerLineCollapsedStatic)if(event==
"mousein"){$("#footerline").animate({width:"100%"},500);setTimeout(function(){$("#welcome_slide").fadeIn()},200);this.footerLineCollapsed=false}else{$("#welcome_slide").fadeOut("fast");setTimeout(function(){$("#footerline").animate({width:"165px"},500)},200);this.footerLineCollapsed=true}},setToggleFooterline:function(collapsed){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=setToggleFooterline&to_pdf=true&footerLineCollapsed="+collapsed,success:function(result){if(result.search('value="Login"')>
-1)twentyreasonstheme.displayLogin(result)}})},toggle:function(item,save,animated){if(this.collapsedStatic[item]||!save){if(load_closed==false&&$("#"+item+" ul").length==0&&save)$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=refresh&widget="+item+"&to_pdf=true&currentModule="+currentModule,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{result=jQuery.parseJSON(result);$("#"+item+" div.widget_content").append(result.content);
if(result.jsinclude.length>0&&$('head [src="'+result.jsinclude+'"]').length<1){var snode=document.createElement("script");snode.setAttribute("type","text/javascript");snode.setAttribute("src",result.jsinclude);document.getElementsByTagName("head")[0].appendChild(snode)}if(result.jsexecute.length>0)eval(result.jsexecute)}}});if(animated==false){$("#expand_"+item+" span").removeClass("arrow_down");$("#expand_"+item+" span").addClass("arrow_up");$("#"+item+" div.widget_content").removeAttr("style")}else{$("#expand_"+
item+" span").removeClass("arrow_down");$("#expand_"+item+" span").addClass("arrow_up");$("#"+item+" div.widget_content").slideDown("slow")}this.collapsed[item]=false;if(save){this.collapsedStatic[item]=false;this.setToggle(false,item)}}else{$("#expand_"+item+" span").removeClass("arrow_up");$("#expand_"+item+" span").addClass("arrow_down");$("#"+item+" div.widget_content").slideUp("slow");this.collapsed[item]=true;if(save){this.collapsedStatic[item]=true;this.setToggle(true,item)}}},toggleSideBar:function(save,
animated){var item="SideBar";if(this.collapsedStatic[item]||!save){if(animated==false){$("#leftBar").css("left","0px");$("#SideBarExpander_arrow").removeClass("arrow_right");$("#SideBarExpander_arrow").addClass("arrow_left");$("div#content").css("margin-left","175px")}else{$("#leftBar").animate({left:"0px"},1E3);$("div#content").animate({marginLeft:"175px"},900);setTimeout(function(){$("#SideBarExpander_arrow").removeClass("arrow_right");$("#SideBarExpander_arrow").addClass("arrow_left")},600)}this.collapsed[item]=
false;if(save){this.collapsedStatic[item]=false;this.setToggle(false,item)}}else{$("#SideBarExpander_arrow").removeClass("arrow_left");$("#SideBarExpander_arrow").addClass("arrow_right");$("#leftBar").animate({left:"-160px"},1E3);$("div#content").animate({marginLeft:"20px"},900);this.collapsed[item]=true;if(save){this.collapsedStatic[item]=true;this.setToggle(true,item)}}},toggleSideBar_mouseover:function(event){var item="SideBar";if(this.collapsedStatic[item])if(event=="mousein"&&this.collapsed[item]){$("#leftBar").animate({left:"0px"},
500,function(){$(".leftbar").css("border-right-width","1px")});this.collapsed[item]=false;this.timedFunction=null}else{$("#leftBar").animate({left:"-160px"},500,function(){$(".leftbar").css("border-right-width","15px")});this.collapsed[item]=true}},triggerSideBar:function(event){this.timedFunction=window.setTimeout("twentyreasonstheme.toggleSideBar_mouseover('"+event+"')",400)},cancelSideBar:function(event){if(this.timedFunction){window.clearTimeout(this.timedFunction);this.timedFunction=null}else twentyreasonstheme.toggleSideBar_mouseover(event)},
getToggle:function(item){if(toggled[item]!==true){if(item=="SideBar")twentyreasonstheme.toggleSideBar(false,false);else twentyreasonstheme.toggle(item,false,false);twentyreasonstheme.collapsedStatic[item]=false}else twentyreasonstheme.collapsedStatic[item]=true},setToggle:function(collapsed,item){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=setToggle&menu="+item+"&to_pdf=true&collapsed="+collapsed,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result)}})},
sortSave:function(){var sort_order="";$("#leftBar div.shortcuts:not(#actionmenu)").each(function(){sort_order+=this.id+","});$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=saveSort&order="+sort_order+"&to_pdf=true",success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result)}})},showConfigSideBar:function(){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=showConfigSideBar&to_pdf=true",success:function(result){if(result.search('value="Login"')>
-1)twentyreasonstheme.displayLogin(result);else{$("body").append('<div id="config_sidebar_dialog">'+result+"</div>");$("#config_sidebar_dialog").dialog({modal:true,buttons:{"Save":function(){var config_string="";$("#config_sidebar_dialog input:checked").each(function(){config_string+=$(this).attr("name")+","});$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=setWidgetUserConfig&param=TRThemeSideBarConfig&value="+config_string+"&to_pdf=true",success:function(result){location.reload()}})},
Cancel:function(){$(this).dialog("close")}}})}}})},subpanelsTabbed:function(){var i=1;$("#subpanel_list li").hide();$("#subpanel_list").before('<ul id="subpanels_tabbed_list" class="subpanelTablist" />');$('#subpanel_list li[id^="whole_subpanel_"]').each(function(){$this=$(this);var title=$("#subpanel_list li#"+this.id+' div[id^="subpanel_title_"] h3 > span').text().trim();var subpanel=this.id.split("whole_subpanel_")[1];var newLi=document.createElement("li");newLi.id="subpanelTabbed_"+subpanel;newLi.title=
subpanel;newLi.style.cursor="pointer";$(newLi).append('<a href="#">'+title+"</a>");$(newLi).hover(function(){$("#whole_subpanel_"+this.title).show();$('#subpanel_list li[id!="whole_subpanel_'+this.title+'"]').hide();$("#subpanels_tabbed_list li a.current").removeClass("current");$(this).children("a").addClass("current")},function(){});if(i==1){$("#whole_subpanel_"+newLi.title).show();$(newLi).children("a").addClass("current")}$("#subpanels_tabbed_list").append(newLi);i++});var newLi=document.createElement("li");
newLi.id="subpanelTabbed_all";newLi.title="all";newLi.style.cursor="pointer";$(newLi).append('<a href="#">All</a>');$(newLi).hover(function(){$("#subpanel_list li").show();$("#subpanels_tabbed_list li a.current").removeClass("current");$(this).children("a").addClass("current")},function(){});$("#subpanels_tabbed_list").append(newLi)},initialize:function(){this.getErrorCount();this.hijackModuleTitle();this.registerEvents();this.setDatepicker()},displayLogin:function(result){$("body").html(result);
$('#form input[name="login_module"]').val(currentModule);$('#form input[name="login_record"]').val(currentRecord);$('#form input[name="login_action"]').val(currentAction)},displayGlobalLinksSubMenu:function(menu_item){$("#"+menu_item+"_submenu").show();$("#"+menu_item+"_submenu").offset({left:$("#"+menu_item+"_link").offset().left-5,top:$("#"+menu_item+"_link").offset().top-$("#"+menu_item+"_submenu").height()-18})},quickNotes:{quickNotesCount:0,quickNotesLoaded:false,filtered:false,open:false,displayQuickNotes:function(){if(twentyreasonstheme.quickNotes.open){$("#ianotes_container").fadeOut();
twentyreasonstheme.quickNotes.open=false}else{if(twentyreasonstheme.quickNotes.quickNotesCount<1)$("#ianotes_new_container").slideDown();if(twentyreasonstheme.quickNotes.quickNotesLoaded)$("#ianotes_container").fadeIn();else $.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=getQuickNotes&to_pdf=true&currentModule="+currentModule+"&record="+document.forms["DetailView"].record.value,success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);
else{var quickNotes=jQuery.parseJSON(result);if(quickNotes.length>0){for(var i=0;i<quickNotes.length;i++){var newLi=document.createElement("li");newLi.id=quickNotes[i].id;if(quickNotes[i].global=="1")newLi.className="ianotes_global";var newSpan=document.createElement("span");newSpan.className="ianotes_title";newSpan.innerHTML=quickNotes[i].user_name+", "+quickNotes[i].date;if(quickNotes[i].own=="1"){var deleteImg=document.createElement("img");deleteImg.src="themes/20reasons/images/Trash.png";deleteImg.className=
"ianotes_delete";deleteImg.title="delete";deleteImg.onclick=function(){twentyreasonstheme.quickNotes.deleteQuickNote(this.parentNode.id);$(this).parent().remove()}}var newDiv=document.createElement("div");newDiv.id=quickNotes[i].id+"_text";newDiv.innerHTML=quickNotes[i].text;if(quickNotes[i].own=="1"){newDiv.title="click to edit";newDiv.onclick=function(){twentyreasonstheme.quickNotes.editQuickNote(this.id)}}$(newLi).append(newDiv);$(newLi).prepend(newSpan);if(quickNotes[i].own=="1")$(newLi).prepend(deleteImg);
$("#ianotes_container ul").append(newLi)}$("#ianotes_new_container").slideUp();twentyreasonstheme.quickNotes.quickNotesLoaded=true}else{twentyreasonstheme.quickNotes.quickNotesLoaded=true;$("#ianotes_new_container").slideDown()}$("#ianotes_header_title").html("QuickNotes for "+$("#leftBar div.moduleTitle h2").text().trim());$("#ianotes_container").fadeIn()}}});twentyreasonstheme.quickNotes.open=true}},filterQuickNotes:function(){if(twentyreasonstheme.quickNotes.filtered){$("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").show();
twentyreasonstheme.quickNotes.filtered=false}else{$("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").hide();twentyreasonstheme.quickNotes.filtered=true}},setQuickNoteIcon:function(){if(twentyreasonstheme.quickNotes.quickNotesCount==0){document.getElementById("ianotesinactive").style.display="block";document.getElementById("ianotesactive").style.display="none"}else{document.getElementById("ianotesinactive").style.display="none";document.getElementById("ianotesactive").style.display=
"block"}},saveQuickNote:function(){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=saveQuickNote&to_pdf=true&currentModule="+currentModule+"&record="+document.forms["DetailView"].record.value+"&global="+$('#ianotes_new input[name="global"]:checked').length,data:{text:document.forms["ianotes_new"].text.value},type:"POST",success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result);else{var quickNotes=jQuery.parseJSON(result);
var newLi=document.createElement("li");newLi.id=quickNotes[0].id;if(quickNotes[0].global=="1"){$("#ianotes_new_container").removeClass("ianotes_global");newLi.className="ianotes_global"}var newSpan=document.createElement("span");newSpan.className="ianotes_title";newSpan.innerHTML=quickNotes[0].user_name+", "+quickNotes[0].date;var newImg=document.createElement("img");newImg.src="themes/20reasons/images/Trash.png";newImg.className="ianotes_delete";newImg.title="delete";newImg.onclick=function(){twentyreasonstheme.quickNotes.deleteQuickNote(this.parentNode.id);
$(this).parent().remove()};var newDiv=document.createElement("div");newDiv.id=quickNotes[0].id+"_text";newDiv.innerHTML=quickNotes[0].text;newDiv.title="click to edit";newDiv.onclick=function(){if(arguments[0].originalTarget==this)twentyreasonstheme.quickNotes.editQuickNote(this.id)};$(newLi).append(newDiv);$(newLi).prepend(newSpan);$(newLi).prepend(newImg);$("#ianotes_new_container").hide();$("#ianotes_new textarea").val("");$("#ianotes_new textarea").text("");$("#ianotes_new textarea").html("");
$('#ianotes_new input[name="global"]').removeAttr("checked");$("#ianotes_new_container").after(newLi);twentyreasonstheme.quickNotes.quickNotesCount++;twentyreasonstheme.quickNotes.setQuickNoteIcon()}}})},editQuickNote:function(text_id){$("#"+text_id).hide();var id=$("#"+text_id).parent().attr("id");$("#"+id+" img#ianotes_delete").hide();var newForm=document.createElement("form");newForm.className="action_buttons";newForm.method="POST";newForm.action="#";newForm.id=id+"_form";var textarea=document.createElement("textarea");
textarea.rows="4";textarea.id=id+"_edittext";textarea.innerHTML=$("#"+id+"_text").text();var label=document.createElement("label");label.style.verticalAlign="bottom";label.innerHTML="global Note:";var global=document.createElement("input");global.id=id+"_global";global.type="checkbox";global.value="1";if($("#"+id).hasClass("ianotes_global"))$(global).attr("checked","checked");global.onclick=function(){$("#"+id).toggleClass("ianotes_global")};var cancel=document.createElement("input");cancel.className=
"button";cancel.type="reset";cancel.value="cancel";cancel.onclick=function(){twentyreasonstheme.quickNotes.abortEditQuickNote($(this).parent().parent().attr("id"))};var submit=document.createElement("input");submit.className="button";submit.type="button";submit.value="save";submit.onclick=function(){twentyreasonstheme.quickNotes.saveEditQuickNote($(this).parent().parent().attr("id"));return false};$(newForm).append(textarea);$(newForm).append("<br>");$(newForm).append(label);$(newForm).append("&nbsp;");
$(newForm).append(global);$(newForm).append("&nbsp;");$(newForm).append(cancel);$(newForm).append("&nbsp;");$(newForm).append(submit);$("#"+id).append(newForm)},saveEditQuickNote:function(id){$("#"+id+"_form").hide();$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=editQuickNote&to_pdf=true&id="+id+"&global="+$("#"+id+"_global:checked").length,data:{text:$("#"+id+"_edittext").val()},type:"POST",success:function(result){if(result.search('value="Login"')>-1)twentyreasonstheme.displayLogin(result)}});
$("#"+id+"_text").html(twentyreasonstheme.quickNotes.nl2br($("#"+id+"_edittext").val(),false));$("#"+id+"_form").remove();$("#"+id+"_text").show();$("#"+id+" img#ianotes_delete").removeAttr("style")},abortEditQuickNote:function(id){$("#"+id+"_form").remove();$("#"+id+"_text").show();$("#"+id+" img#ianotes_delete").removeAttr("style")},deleteQuickNote:function(id){$.ajax({url:"index.php?module=TRThemeController&action=ajaxController&ajaxAction=deleteQuickNote&to_pdf=true&id="+id,success:function(result){if(result.search('value="Login"')>
-1)twentyreasonstheme.displayLogin(result);else{twentyreasonstheme.quickNotes.quickNotesCount--;twentyreasonstheme.quickNotes.setQuickNoteIcon();if(twentyreasonstheme.quickNotes.quickNotesCount<1){$("#ianotes_new_container").slideDown();$("#ianotes_container").fadeOut();twentyreasonstheme.quickNotes.open=false}}}})},formClose:function(){if(twentyreasonstheme.quickNotes.quickNotesCount<1){$("#ianotes_container").fadeOut();twentyreasonstheme.quickNotes.open=false}$("#ianotes_new_container").slideUp()},
nl2br:function(str,is_xhtml){var breakTag=is_xhtml||typeof is_xhtml==="undefined"?"<br />":"<br>";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")}}};
